# Internationalization (i18n) Support

The `@drewsonne/maya-dates` library provides internationalization (i18n) support to handle alternative spellings and transliterations of Maya calendar terms. Since there is no authoritative transliteration of Maya terms into English (or other languages), this feature allows you to parse dates using various conventional spellings and render them in your preferred format.

## Key Features

- **Alternative Spelling Support**: Parse Maya dates using different conventional transliterations
- **Locale-based Rendering**: Render Maya calendar terms in different spelling systems
- **Backward Compatible**: Existing code continues to work without any changes
- **Extensible**: Register your own locale definitions with custom spellings

## Quick Start

### Parsing Alternative Spellings

```typescript
import { 
  CalendarRoundFactory, 
  getI18nManager, 
  LocaleDefinition 
} from '@drewsonne/maya-dates';

// Get the i18n manager instance
const i18n = getI18nManager();

// Register alternative spellings
const altSpellings: LocaleDefinition = {
  locale: 'alternative',
  name: 'Alternative Spellings',
  tzolkinDays: {
    'Ajaw': { canonical: 'Ajaw', alternatives: ['Ahau', 'Ajau'] }
  },
  haabMonths: {
    'Kumk\'u': { canonical: 'Kumk\'u', alternatives: ['Kumku', 'Cumku'] }
  }
};

i18n.registerLocale(altSpellings);

// Now you can parse dates using any registered spelling
const factory = new CalendarRoundFactory();
const cr1 = factory.parse('4 Ahau 8 Kumku');      // Alternative spelling
const cr2 = factory.parse('4 Ajaw 8 Kumk\'u');    // Canonical spelling

// Both produce the same canonical result
console.log(cr1.toString()); // "4 Ajaw 8 Kumk'u"
console.log(cr2.toString()); // "4 Ajaw 8 Kumk'u"
```

### Rendering in Different Locales

```typescript
import { 
  getTzolkinDay, 
  getHaabMonth, 
  getI18nManager,
  LocaleDefinition 
} from '@drewsonne/maya-dates';

const i18n = getI18nManager();

// Register a simplified spelling locale (no apostrophes)
const simplified: LocaleDefinition = {
  locale: 'simplified',
  name: 'Simplified Spellings',
  tzolkinDays: {
    'Ik\'': { canonical: 'Ik', alternatives: [] },
    'Ak\'bal': { canonical: 'Akbal', alternatives: [] }
  },
  haabMonths: {
    'K\'ayab': { canonical: 'Kayab', alternatives: [] }
  }
};

i18n.registerLocale(simplified);

// Get calendar components
const day = getTzolkinDay('Ik\'');
const month = getHaabMonth('K\'ayab');

// Render in different locales
console.log(day.toString());                      // "Ik'" (default)
console.log(day.toLocaleString('simplified'));    // "Ik" (simplified)

console.log(month.toString());                    // "K'ayab" (default)
console.log(month.toLocaleString('simplified'));  // "Kayab" (simplified)
```

## Core Concepts

### Locale Definition

A locale definition specifies:
- **locale**: Unique identifier for the locale (e.g., 'simplified', 'classical')
- **name**: Human-readable name
- **tzolkinDays**: Mapping of Tzolkin day names with alternatives
- **haabMonths**: Mapping of Haab month names with alternatives

### Translation Structure

Each translation consists of:
- **canonical**: The preferred spelling for this locale
- **alternatives**: Array of alternative spellings that should be accepted during parsing

### Normalization Process

When parsing:
1. Input string is tokenized into components
2. Each Tzolkin day or Haab month name is normalized using the i18n manager
3. Alternative spellings are automatically mapped to canonical forms
4. The canonical form is used internally for all operations

When rendering:
1. Components are rendered using the default `toString()` method (canonical form)
2. Use `toLocaleString(locale)` to render in a specific locale's spelling

## API Reference

### I18nManager

The `I18nManager` is a singleton that manages all locale registrations.

```typescript
import { getI18nManager, I18nManager } from '@drewsonne/maya-dates';

// Get singleton instance
const i18n = getI18nManager();
// or
const i18n = I18nManager.getInstance();
```

#### Methods

##### `registerLocale(localeDefinition: LocaleDefinition): void`

Register a new locale with its translations.

```typescript
i18n.registerLocale({
  locale: 'my-locale',
  name: 'My Custom Locale',
  tzolkinDays: { /* ... */ },
  haabMonths: { /* ... */ }
});
```

##### `setActiveLocale(locale: Locale): void`

Set the active locale for rendering (when locale is not specified in `toLocaleString`).

```typescript
i18n.setActiveLocale('simplified');
```

##### `getActiveLocale(): Locale`

Get the current active locale.

```typescript
const active = i18n.getActiveLocale(); // 'default' by default
```

##### `getRegisteredLocales(): Locale[]`

Get all registered locale identifiers.

```typescript
const locales = i18n.getRegisteredLocales();
// ['default', 'alternative', 'simplified']
```

##### `normalizeTzolkinDay(name: string): string`

Normalize a Tzolkin day name to its canonical form.

```typescript
const canonical = i18n.normalizeTzolkinDay('Ahau'); // 'Ajaw'
```

##### `normalizeHaabMonth(name: string): string`

Normalize a Haab month name to its canonical form.

```typescript
const canonical = i18n.normalizeHaabMonth('Kumku'); // "Kumk'u"
```

##### `renderTzolkinDay(canonicalName: string, locale?: Locale): string`

Render a Tzolkin day name in the specified locale.

```typescript
const rendered = i18n.renderTzolkinDay('Ik\'', 'simplified'); // 'Ik'
```

##### `renderHaabMonth(canonicalName: string, locale?: Locale): string`

Render a Haab month name in the specified locale.

```typescript
const rendered = i18n.renderHaabMonth('K\'ayab', 'simplified'); // 'Kayab'
```

### Component Methods

#### TzolkinDay and HaabMonth

Both components now support locale-aware rendering:

```typescript
import { getTzolkinDay, getHaabMonth } from '@drewsonne/maya-dates';

const day = getTzolkinDay('Ajaw');
const month = getHaabMonth('Kumk\'u');

// Default rendering (canonical form)
day.toString();    // 'Ajaw'
month.toString();  // "Kumk'u"

// Locale-specific rendering
day.toLocaleString('simplified');    // Custom rendering if defined
month.toLocaleString('simplified');  // Custom rendering if defined
```

## Common Use Cases

### Supporting Classical Mayan Orthography

```typescript
const classical: LocaleDefinition = {
  locale: 'classical',
  name: 'Classical Mayan Orthography',
  tzolkinDays: {
    'Ajaw': { canonical: 'Ajaw', alternatives: ['Ahau'] },
    'Imix': { canonical: 'Imix', alternatives: ['Imix'] },
    // ... other days
  },
  haabMonths: {
    'Pop': { canonical: 'Pop', alternatives: ['Pop'] },
    // ... other months
  }
};

i18n.registerLocale(classical);
```

### Simplified Spellings (No Apostrophes)

```typescript
const noApostrophes: LocaleDefinition = {
  locale: 'no-apostrophes',
  name: 'Simplified (No Apostrophes)',
  tzolkinDays: {
    'Ik\'': { canonical: 'Ik', alternatives: [] },
    'Ak\'bal': { canonical: 'Akbal', alternatives: [] },
    'K\'an': { canonical: 'Kan', alternatives: [] },
    'Manik\'': { canonical: 'Manik', alternatives: [] },
    'Etz\'nab': { canonical: 'Etznab', alternatives: [] }
  },
  haabMonths: {
    'Sotz\'': { canonical: 'Sotz', alternatives: [] },
    'Yaxk\'in': { canonical: 'Yaxkin', alternatives: [] },
    'Ch\'en': { canonical: 'Chen', alternatives: [] },
    'K\'ank\'in': { canonical: 'Kankin', alternatives: [] },
    'K\'ayab': { canonical: 'Kayab', alternatives: [] },
    'Kumk\'u': { canonical: 'Kumku', alternatives: [] }
  }
};

i18n.registerLocale(noApostrophes);
```

### Multiple Variant Support

```typescript
const multiVariant: LocaleDefinition = {
  locale: 'multi',
  name: 'Multiple Variants',
  tzolkinDays: {
    'Ajaw': { 
      canonical: 'Ajaw', 
      alternatives: ['Ahau', 'Ajau', 'Ahaw'] 
    }
  },
  haabMonths: {
    'Kumk\'u': { 
      canonical: 'Kumk\'u', 
      alternatives: ['Kumku', 'Cumku', 'K\'umk\'u'] 
    }
  }
};

i18n.registerLocale(multiVariant);
```

## Best Practices

1. **Register locales early**: Register all locales at application startup before parsing dates
2. **Use canonical forms internally**: The library automatically normalizes to canonical forms
3. **Consistent locale usage**: Use the same locale for rendering within a given context
4. **Test your locale definitions**: Ensure alternative spellings map correctly to canonical forms
5. **Document your locale**: Add clear names and descriptions to your locale definitions

## Examples

See `examples/i18n.ts` for a complete working example demonstrating:
- Parsing with alternative spellings
- Rendering in different locales
- Round-trip parsing and rendering
- Locale management

Run the example:
```bash
npx ts-node examples/i18n.ts
```

## Backward Compatibility

The i18n feature is completely backward compatible:
- Existing code works without any changes
- Default locale uses canonical spellings
- No performance impact if i18n is not used
- All existing tests continue to pass

## Future Enhancements

Potential future improvements:
- Pre-defined locale packs for common spelling systems
- Language-specific transliterations (Spanish, French, etc.)
- Unicode support for original Maya glyphs
- Integration with rendering libraries for visual output
